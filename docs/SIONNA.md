# Sionna Integration üõ∞Ô∏è

This document covers the Sionna ray-tracing integration for physics-based radio propagation simulation.

---

## Current Status

| Component | Status | Notes |
|-----------|--------|-------|
| Scene loading | ‚úÖ Working | Mitsuba XML format |
| Radio map generation | ‚úÖ Working | 7-channel maps |
| Ray tracing (PathSolver) | ‚úÖ Working | GPU-accelerated |
| Mock mode | ‚úÖ Working | For testing without Sionna |

---

## How It Works

### Data Generation (M2)

Sionna RT is used during **data generation** to simulate realistic radio propagation:

```python
from sionna.rt import load_scene, PathSolver

# Load scene generated by M1
scene = load_scene("data/scenes/austin/scene.xml")

# Run ray tracing
paths = PathSolver()(scene, tx_positions, rx_positions)

# Extract features: path gains, delays, angles
path_gains = paths.a  # Complex path coefficients
delays = paths.tau    # Time of arrival per path
```

### Radio Maps (M4)

Precomputed Sionna radio maps provide physics priors for training:

```python
from sionna.rt import RadioMapSolver

# Generate dense spatial map
radio_map = RadioMapSolver()(
    scene,
    tx_positions,
    resolution=1.0,  # 1 meter per pixel
    map_size=(512, 512)
)
```

**Map Channels**: path_gain, ToA, AoA, SNR, SINR, throughput, BLER

---

## Running With/Without Sionna

### With Sionna (Full Mode)

```bash
# Install Sionna + TensorFlow
pip install sionna tensorflow

# Generate real data
python scripts/generate_dataset.py \
    --scene-dir data/scenes \
    --output-dir data/processed
```

### Without Sionna (Mock Mode)

For development and testing without the heavy Sionna dependency:

```bash
# Use mock mode (default when Sionna not installed)
python scripts/generate_dataset.py \
    --scene-dir data/scenes \
    --output-dir data/processed \
    --use-mock
```

Mock mode generates synthetic features with realistic distributions but no actual ray tracing.

---

## Key Files

| File | Purpose |
|------|---------|
| `src/data_generation/multi_layer_generator.py` | RT simulation orchestration |
| `src/physics_loss/radio_map_generator.py` | Precomputed map generation |
| `src/data_generation/osm_rasterizer.py` | OSM ‚Üí building geometry |

---

## Known Limitations

1. **GPU Memory**: Large scenes with many paths can exhaust VRAM
2. **TensorFlow Dependency**: Sionna requires TensorFlow (not PyTorch)
3. **Coordinate Systems**: Ensure scene coordinates match map coordinates

---

## Troubleshooting

**"Module 'sionna' not found"**
```bash
pip install sionna tensorflow
```

**"CUDA out of memory"**
- Reduce `max_depth` in PathSolver
- Use smaller `num_samples`
- Process scenes in batches

**"RadioMap is all zeros"**
- Check TX positions are within scene bounds
- Verify scene.xml loaded correctly
- Increase `resolution` if scene is small
